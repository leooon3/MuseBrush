<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuseBrush</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<!-- Main Container -->
<div class="app-container">
    <!-- Top Toolbar -->
    <div class="top-toolbar glass-effect">
        <div class="logo">
            <span>Muse</span><span style="color: var(--gold-primary)">Brush</span>
            <span class="logo-badge">BETA</span>
        </div>
        <div id="sortable-tools" class="toolbar-tools">
            <button id="select-tool" class="tool-button active" title="Select" data-tool="select"><i class="bi bi-cursor-fill"></i></button>
            <button id="draw-tool" class="tool-button" title="Draw" data-tool="draw"><i class="bi bi-pencil-fill"></i></button>
            <div class="tool-group">
                <button id="rect-tool" class="tool-button" title="Rectangle" data-tool="rect"><i class="bi bi-square"></i></button>
                <button id="circle-tool" class="tool-button" title="Circle" data-tool="circle"><i class="bi bi-circle"></i></button>
                <button id="triangle-tool" class="tool-button" title="Triangle" data-tool="triangle"><i class="bi bi-triangle"></i></button>
            </div>
            <button id="text-tool" class="tool-button" title="Text" data-tool="text"><i class="bi bi-type"></i></button>
            <button id="upload-image" class="tool-button" title="Upload Image" data-tool="image"><i class="bi bi-image"></i></button>
            <input type="file" id="image-upload" accept="image/*" style="display: none">
        </div>
        <div class="toolbar-actions">
            <div class="action-group">
                <button id="zoom-in" class="action-button" title="Zoom In"><i class="bi bi-zoom-in"></i></button>
                <button id="zoom-out" class="action-button" title="Zoom Out"><i class="bi bi-zoom-out"></i></button>
                <button id="zoom-reset" class="action-button" title="Reset Zoom"><i class="bi bi-aspect-ratio"></i></button>
            </div>
            <div class="action-divider"></div>
            <div class="action-group">
                <button id="undo-button" class="action-button" title="Undo (Ctrl+Z)" disabled><i class="bi bi-arrow-counterclockwise"></i></button>
                <button id="redo-button" class="action-button" title="Redo (Ctrl+Y)" disabled><i class="bi bi-arrow-clockwise"></i></button>
                <button id="history-button" class="action-button" title="History Panel"><i class="bi bi-clock-history"></i></button>
            </div>
            <div class="action-divider"></div>
            <div class="action-group">
                <button id="new-canvas" class="action-button" title="New Canvas"><i class="bi bi-file-earmark-plus"></i></button>
                <button id="gallery-button" class="action-button" title="Gallery"><i class="bi bi-grid-3x3-gap"></i></button>
                <button id="clear-canvas" class="action-button" title="Clear Canvas"><i class="bi bi-trash"></i></button>
                <button id="save-canvas" class="action-button" title="Download Canvas"><i class="bi bi-download"></i></button>
                <button id="theme-toggle" class="action-button" title="Toggle Theme"><i class="bi bi-moon"></i></button>
                <button id="sidebarToggle" class="action-button" title="Toggle Properties"><i class="bi bi-sliders"></i></button>
            </div>
        </div>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-area">
        <div id="zoom-container" class="zoom-container">
            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
        </div>

        <!-- Zoom Indicator -->
        <div class="zoom-indicator">
            <i class="bi bi-search"></i>
            <span id="zoom-level">100%</span>
        </div>

        <!-- Footer info -->
        <div class="footer-info">
            <i class="bi bi-info-circle"></i>
            <span>Hold Alt to pan • Ctrl+scroll to zoom</span>
        </div>

        <!-- History Panel -->
        <div id="history-panel" class="history-panel glass-effect">
            <div class="history-panel-header">
                <h5>History</h5>
                <div class="history-panel-actions">
                    <button id="clear-history" class="history-action-button" title="Clear History"><i class="bi bi-trash3"></i></button>
                    <button id="close-history" class="history-action-button" title="Close"><i class="bi bi-x"></i></button>
                </div>
            </div>
            <div id="history-list" class="history-list">
                <!-- History items will be inserted here dynamically -->
            </div>
            <div class="history-panel-footer">
                <div class="history-shortcuts">
                    <span><kbd class="shortcut-key">Ctrl</kbd>+<kbd class="shortcut-key">Z</kbd> <span class="shortcut-text">Undo</span></span>
                    <span><kbd class="shortcut-key">Ctrl</kbd>+<kbd class="shortcut-key">Y</kbd> <span class="shortcut-text">Redo</span></span>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div id="sidebar" class="sidebar glass-effect">
            <div class="sidebar-header">
                <h5>Properties</h5>
                <button id="sidebarCollapse" class="button-close"></button>
            </div>
            <div class="sidebar-section">
                <h6>Stroke Color</h6>
                <input type="text" id="color-picker" data-coloris value="#000000">
            </div>
            <div class="sidebar-section">
                <h6>Stroke Width</h6>
                <div class="range-with-value">
                    <input type="range" id="stroke-width" min="1" max="20" value="3" class="form-range">
                    <span class="range-value" id="stroke-width-value">3px</span>
                </div>
            </div>
            <div class="sidebar-section">
                <h6>Fill</h6>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="fill-toggle">
                    <label class="form-check-label" for="fill-toggle">Fill Shape</label>
                </div>
                <input type="text" id="fill-color" data-coloris value="#ffffff" class="mt-2" disabled>
            </div>
        </div>
    </div>
</div>

<!-- Gallery Modal -->
<div class="modal fade" id="galleryModal" tabindex="-1" aria-labelledby="galleryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="galleryModalLabel">My Gallery</h5>
                <button type="button" class="button-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Add New Canvas Form -->
                <div class="save-form mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="canvasName" placeholder="Enter artwork name...">
                        </div>
                        <div class="col-md-4 d-flex justify-content-end">
                            <button type="button" class="button button-primary" id="confirmSaveToGallery">
                                <i class="bi bi-plus-circle me-1"></i> Save Current Canvas
                            </button>
                        </div>
                    </div>
                    <div class="canvas-preview mt-3" style="display: none;">
                        <img id="canvasPreview" alt="Canvas Preview">
                    </div>
                </div>

                <!-- Gallery Items -->
                <div class="gallery-empty-state" id="galleryEmptyState">
                    <i class="bi bi-images"></i>
                    <h5>Your gallery is empty</h5>
                    <p>Save your artwork to see it here</p>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Gallery items will be inserted here by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="button button-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- New Canvas Modal -->
<div class="modal fade" id="newCanvasModal" tabindex="-1" aria-labelledby="newCanvasModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="newCanvasModalLabel">Create New Canvas</h5>
                <button type="button" class="button-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newCanvasForm">
                    <div class="mb-3">
                        <label for="canvasWidth" class="form-label">Width (px)</label>
                        <input type="number" class="form-control" id="canvasWidth" min="50" max="3000" value="800">
                    </div>
                    <div class="mb-3">
                        <label for="canvasHeight" class="form-label">Height (px)</label>
                        <input type="number" class="form-control" id="canvasHeight" min="50" max="3000" value="600">
                    </div>
                    <div class="mb-3">
                        <label for="canvasBackground" class="form-label">Background Color</label>
                        <input type="text" data-coloris class="form-control" id="canvasBackground" value="#ffffff">
                    </div>
                    <div class="preset-sizes">
                        <button type="button" class="preset-size-button" data-width="800" data-height="600">800 × 600</button>
                        <button type="button" class="preset-size-button" data-width="1280" data-height="720">1280 × 720</button>
                        <button type="button" class="preset-size-button" data-width="1920" data-height="1080">1920 × 1080</button>
                        <button type="button" class="preset-size-button" data-width="1080" data-height="1080">1080 × 1080</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="button button-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="button button-primary" id="createNewCanvas">Create</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
</body>
</html>